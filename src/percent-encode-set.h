#ifndef URL_PERCENT_ENCODE_SET
#define URL_PERCENT_ENCODE_SET

#include <stdbool.h>
#include <stdint.h>
#include <utf.h>
#include <utf/string.h>

/**
 * A percent encode set is stored as a 32 x 8 bit list with each bit
 * representing an ASCII byte. A given ASCII byte should be percent
 * encoded if its corresponding bit is set in the percent encode set.
 */
typedef const uint8_t url_percent_encode_set_t[32];

static inline bool
url__is_in_percent_encode_set (url_percent_encode_set_t percent_encode_set, utf8_t character) {
  return (percent_encode_set[character >> 3] & (1 << (character & 7))) != 0;
}

static inline bool
url__contains_in_percent_encode_set (url_percent_encode_set_t percent_encode_set, utf8_string_view_t input) {
  size_t i = 0, n = input.len;

  uint8_t accumulator = 0;

  for (; i + 4 <= n; i += 4) {
    accumulator |= url__is_in_percent_encode_set(percent_encode_set, input.data[i]);
    accumulator |= url__is_in_percent_encode_set(percent_encode_set, input.data[i + 1]);
    accumulator |= url__is_in_percent_encode_set(percent_encode_set, input.data[i + 2]);
    accumulator |= url__is_in_percent_encode_set(percent_encode_set, input.data[i + 4]);
  }

  for (; i < n; i++) {
    accumulator |= url__is_in_percent_encode_set(percent_encode_set, input.data[i]);
  }

  return accumulator;
}

// https://url.spec.whatwg.org/#c0-control-percent-encode-set
static url_percent_encode_set_t url__c0_control_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 40    41     42     43     44     45     46     47
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#query-percent-encode-set
static url_percent_encode_set_t url__query_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x04 | 0x08 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x40 | 0x00,
  // 40    41     42     43     44     45     46     47
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#special-query-percent-encode-set
static url_percent_encode_set_t url__special_query_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x04 | 0x08 | 0x00 | 0x00 | 0x00 | 0x80,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x40 | 0x00,
  // 40    41     42     43     44     45     46     47
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#fragment-percent-encode-set
static url_percent_encode_set_t url__fragment_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x04 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x40 | 0x00,
  // 40    41     42     43     44     45     46     47
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#userinfo-percent-encode-set
static url_percent_encode_set_t url__userinfo_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x04 | 0x08 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 40    41     42     43     44     45     46     47
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x08 | 0x10 | 0x20 | 0x40 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x08 | 0x10 | 0x20 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#path-percent-encode-set
static url_percent_encode_set_t url__path_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x04 | 0x08 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x40 | 0x80,
  // 40    41     42     43     44     45     46     47
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x08 | 0x00 | 0x20 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 90    91     92     93     94     95     96     97
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // d8    d9     da     db     dc     dd     de     df
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
};

// https://url.spec.whatwg.org/#forbidden-host-code-point
static url_percent_encode_set_t url__host_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x00 | 0x02 | 0x04 | 0x00 | 0x00 | 0x20 | 0x00 | 0x00,
  // 10    11     12     13     14     15     16     17
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x00 | 0x08 | 0x00 | 0x00 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x04 | 0x00 | 0x10 | 0x00 | 0x40 | 0x80,
  // 40    41     42     43     44     45     46     47
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x08 | 0x10 | 0x20 | 0x40 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x00 | 0x00,
  // 80    81     82     83     84     85     86     87
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 90    91     92     93     94     95     96     97
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // d8    d9     da     db     dc     dd     de     df
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
};

// https://url.spec.whatwg.org/#forbidden-domain-code-point
static url_percent_encode_set_t url__domain_percent_encode_set = {
  // 00    01     02     03     04     05     06     07
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 08    09     0a     0b     0c     0d     0e     0f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 10    11     12     13     14     15     16     17
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 18    19     1a     1b     1c     1d     1e     1f
  0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,
  // 20    21     22     23     24     25     26     27
  0x01 | 0x00 | 0x00 | 0x08 | 0x00 | 0x20 | 0x00 | 0x00,
  // 28    29     2a     2b     2c     2d     2e     2f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,
  // 30    31     32     33     34     35     36     37
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 38    39     3a     3b     3c     3d     3e     3f
  0x00 | 0x00 | 0x04 | 0x00 | 0x10 | 0x00 | 0x40 | 0x80,
  // 40    41     42     43     44     45     46     47
  0x01 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 48    49     4a     4b     4c     4d     4e     4f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 50    51     52     53     54     55     56     57
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 58    59     5a     5b     5c     5d     5e     5f
  0x00 | 0x00 | 0x00 | 0x08 | 0x10 | 0x20 | 0x40 | 0x00,
  // 60    61     62     63     64     65     66     67
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 68    69     6a     6b     6c     6d     6e     6f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 70    71     72     73     74     75     76     77
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 78    79     7a     7b     7c     7d     7e     7f
  0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x00 | 0x80,
  // 80    81     82     83     84     85     86     87
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 88    89     8a     8b     8c     8d     8e     8f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 90    91     92     93     94     95     96     97
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // 98    99     9a     9b     9c     9d     9e     9f
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // a0    a1     a2     a3     a4     a5     a6     a7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // a8    a9     aa     ab     ac     ad     ae     af
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // b0    b1     b2     b3     b4     b5     b6     b7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // b8    b9     ba     bb     bc     bd     be     bf
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // c0    c1     c2     c3     c4     c5     c6     c7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // c8    c9     ca     cb     cc     cd     ce     cf
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // d0    d1     d2     d3     d4     d5     d6     d7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // d8    d9     da     db     dc     dd     de     df
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // e0    e1     e2     e3     e4     e5     e6     e7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // e8    e9     ea     eb     ec     ed     ee     ef
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // f0    f1     f2     f3     f4     f5     f6     f7
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
  // f8    f9     fa     fb     fc     fd     fe     ff
  0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,
};

#endif // URL_PERCENT_ENCODE_SET
